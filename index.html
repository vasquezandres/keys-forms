<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Solicitud de licencia</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b1220;color:#e5e7eb;margin:0;padding:16px}
    .card{max-width:520px;margin:0 auto;background:#020617;border-radius:18px;border:1px solid #1f2937;padding:20px 18px;box-shadow:0 16px 40px rgba(0,0,0,.6)}
    .top{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:10px}
    .brandLogo{width:90px;height:90px;background:transparent;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .brandLogo img{width:82%;height:auto;display:block;object-fit:contain}
    h1{font-size:20px;margin:0;text-align:center}
    p.desc{font-size:13px;color:#9ca3af;margin:0 0 16px;text-align:center;line-height:1.4}
    label{font-size:12px;color:#9ca3af;display:block;margin-bottom:4px}
    input,select,textarea{width:100%;padding:9px 10px;border-radius:10px;border:1px solid #1f2937;background:#020617;color:#e5e7eb;font-size:13px;box-sizing:border-box;outline:none}
    textarea{min-height:80px;resize:vertical}
    .field{margin-bottom:12px}
    .productRow{display:flex;gap:12px;align-items:flex-start}
    .productRow .field{flex:1;margin-bottom:0}
    .productPreview{width:64px;height:64px;border-radius:14px;background:#0b1220;border:1px solid #1f2937;display:flex;align-items:center;justify-content:center;overflow:hidden;flex:0 0 auto}
    .productPreview img{width:82%;height:auto;display:block;object-fit:contain}
    .productHint{font-size:11px;color:#6b7280;margin-top:6px}
    button{width:100%;margin-top:6px;padding:11px;border-radius:999px;border:none;cursor:pointer;background:#ff1748;color:#fff;font-size:14px;font-weight:600}
    button:disabled{opacity:.55;cursor:not-allowed}
    .msg{margin-top:10px;font-size:12px;color:#9ca3af;text-align:center;min-height:16px}
    .small{font-size:11px;color:#6b7280;margin-top:8px;text-align:center}
    .captchaWrap{margin-top:10px}
  </style>
</head>

<body>
  <div class="card">
    <div class="top">
      <div class="brandLogo" title="Solutech">
        <img src="https://cdn.solutechcloud.com/logos/solutech-logo.webp" alt="Solutech" loading="eager" />
      </div>
    </div>

    <h1>Solicitud de licencia</h1>
    <p class="desc">Completa tus datos y te enviaremos tu licencia una vez confirmemos el pago.</p>

    <form id="form">
      <div class="field">
        <label for="nombre">Nombre y apellido *</label>
        <input id="nombre" name="nombre" required />
      </div>

      <div class="field">
        <label for="email">Correo electrónico *</label>
        <input id="email" name="email" type="email" required />
      </div>

      <div class="field">
        <label for="whatsapp">WhatsApp (con código de país) *</label>
        <input id="whatsapp" name="whatsapp" placeholder="+507 6560-7903" required />
      </div>

      <div class="productRow">
        <div class="field">
          <label for="producto">Producto (opcional)</label>
          <select id="producto" name="producto">
            <option value="">Selecciona una opción</option>
            <option value="McAfee">McAfee</option>
            <option value="Kaspersky Standard">Kaspersky Standard</option>
            <option value="Kaspersky Plus">Kaspersky Plus</option>
            <option value="Kaspersky Premium">Kaspersky Premium</option>
            <option value="Kaspersky Small Office">Kaspersky Small Office</option>
            <option value="ESET Antivirus">ESET Antivirus</option>
            <option value="Microsoft 365 Personal">Microsoft 365 Personal</option>
            <option value="Microsoft 365 Family">Microsoft 365 Family</option>
            <option value="Sage 50 (Peachtree)">Sage 50 (Peachtree)</option>
            <option value="Otro / No estoy seguro">Otro / No estoy seguro</option>
          </select>
          <div class="productHint">Al elegir el producto verás el logo.</div>
        </div>

        <div class="productPreview" title="Logo del producto">
          <img id="prodLogo" src="https://cdn.solutechcloud.com/logos/logo-generico-software.webp" alt="Producto" />
        </div>
      </div>

      <div class="field" style="margin-top:12px;">
        <label for="dispositivos">Dispositivos (opcional)</label>
        <input id="dispositivos" name="dispositivos" type="number" min="1" placeholder="Ej: 1, 3, 5" />
      </div>

      <div class="field">
        <label for="anios">Años de licencia (opcional)</label>
        <input id="anios" name="anios" type="number" min="1" placeholder="Ej: 1, 2" />
      </div>

      <div class="field">
        <label for="observaciones">Observaciones / Nota para Solutech (opcional)</label>
        <textarea id="observaciones" name="observaciones" placeholder="Ej: Quiero renovar; tengo dudas con la instalación, etc."></textarea>
      </div>

      <div class="captchaWrap">
        <label>Verificación *</label>
        <div
          class="cf-turnstile"
          data-sitekey="0x4AAAAAACaNgwm6H2acT8vb"
          data-callback="tsOk"
          data-expired-callback="tsExpired"
          data-error-callback="tsError"
        ></div>
        <div class="productHint">El botón se habilita cuando completes la verificación.</div>
      </div>

      <button type="submit" id="btn" disabled>Enviar solicitud</button>
      <div class="msg" id="msg"></div>
      <div class="small">Solutech Panamá · Soporte WhatsApp +507 6888-6778</div>
    </form>
  </div>


<script>
  // === CONFIG ===
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyJyblqviFaiI-JqR4Zs2XCsNZqCVY_NL8wD5OGiYlMlySKpPmegDizWeT2WNA_T3MEtg/exec";

  const form = document.getElementById('form');
  const btn  = document.getElementById('btn');
  const msg  = document.getElementById('msg');
  const sel  = document.getElementById('producto');
  const prodLogo = document.getElementById('prodLogo');

  let turnstileToken = "";

  const LOGOS = {
    mcafee: "https://cdn.solutechcloud.com/logos/logo-mcafee.webp",
    kaspersky: "https://cdn.solutechcloud.com/logos/logo-kaspersky.webp",
    eset: "https://cdn.solutechcloud.com/logos/logo-eset.webp",
    microsoft: "https://cdn.solutechcloud.com/logos/logo-m365.webp",
    sage: "https://cdn.solutechcloud.com/logos/logo-sage.webp",
    generico: "https://cdn.solutechcloud.com/logos/logo-generico-software.webp"
  };

  function pickLogo(producto){
    const p = (producto || "").toLowerCase();
    if (p.includes("mcafee")) return LOGOS.mcafee;
    if (p.includes("kaspersky")) return LOGOS.kaspersky;
    if (p.includes("eset")) return LOGOS.eset;
    if (p.includes("microsoft") || p.includes("office") || p.includes("365")) return LOGOS.microsoft;
    if (p.includes("sage") || p.includes("peachtree")) return LOGOS.sage;
    return LOGOS.generico;
  }

  sel.addEventListener('change', () => {
    prodLogo.src = pickLogo(sel.value);
  });

  // Turnstile callbacks (globales)
  window.tsOk = function(token){
    turnstileToken = token || "";
    btn.disabled = !turnstileToken;
    msg.textContent = "";
  };
  window.tsExpired = function(){
    turnstileToken = "";
    btn.disabled = true;
    msg.textContent = "La verificación expiró. Complétala de nuevo.";
  };
  window.tsError = function(){
    turnstileToken = "";
    btn.disabled = true;
    msg.textContent = "No se pudo validar Turnstile. Intenta otra vez.";
  };

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const nombre = form.nombre.value.trim();
    const email  = form.email.value.trim();
    const whatsapp = form.whatsapp.value.trim();

    if (!nombre || !email || !whatsapp){
      msg.textContent = "Por favor completa nombre, correo y WhatsApp.";
      return;
    }
    if (!turnstileToken){
      msg.textContent = "Completa la verificación para enviar.";
      return;
    }

    const datos = {
      action: "registrarSolicitud",
      nombre,
      email,
      whatsapp,
      producto:      form.producto.value.trim(),
      dispositivos:  form.dispositivos.value.trim(),
      anios:         form.anios.value.trim(),
      observaciones: form.observaciones.value.trim(),
      turnstileToken
    };

    btn.disabled = true;
    msg.textContent = "Enviando solicitud...";

    try {
      const qs = new URLSearchParams(datos).toString();
      const url = `${WEBAPP_URL}?${qs}`;

      const r = await fetch(url, { method: "GET" });
      const j = await r.json().catch(() => null);

      if (!j || !j.ok) {
        throw new Error(j && j.message ? j.message : "No se pudo enviar.");
      }

      msg.textContent = "Solicitud enviada correctamente. Te contactaremos en breve.";
      form.reset();
      prodLogo.src = LOGOS.generico;
      turnstileToken = "";
      btn.disabled = true;

      // Si quieres resetear el widget manualmente:
      // if (window.turnstile) turnstile.reset();

    } catch (err) {
      msg.textContent = "Error: " + (err && err.message ? err.message : err);
      btn.disabled = false;
    }
  });
</script>



</body>
</html>
